// Connexion à la base de données
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Générateur de client pour le code JS
generator client {
  provider = "prisma-client-js"
}

// Table des Utilisateurs
model User {
  id           Int      @id @default(autoincrement())
  pseudo       String   @unique
  passwordHash String
  role         String   @default("MEMBRE") // "LEADER", "CHEF-ADJOINT" ou "MEMBRE"
  firstLogin   Boolean  @default(true)
  createdAt    DateTime @default(now())
  
  // Relation : Un user a plusieurs Dinozs
  dinozs       Dinoz[]
}


// Table des Dinozs
model Dinoz {
  id        Int     @id @default(autoincrement())
  name      String
  race      String
  imageUrl  String?
  level     Int     @default(1)
  notes     String?
  
  // Stats
  statFire  Int     @default(0)
  statWood  Int     @default(0)
  statWater Int     @default(0)
  statBolt  Int     @default(0)
  statAir   Int     @default(0)
// Stats Générales
  statLife       Int @default(100)
  statSpeed      Int @default(10)
  statInitiative Int @default(0)
  statCounter    Int @default(0)
  statDodge      Int @default(0)
  statArmor      Int @default(0)

  // Propriétaire
  userId    Int
  user      User    @relation(fields: [userId], references: [id])
  
  // 1. Compétences Apprises
  learnedSkills   RefSkill[] @relation("LearnedSkills")
  // 2. Compétences Débloquées (Disponibles)
  unlockedSkills  RefSkill[] @relation("UnlockedSkills")

  // Historique des ups (JSON)
  ups       Json? 

  // Dinoz Récincarné ? -- 1 pour oui -- 0 pour non
  isReincarnate   Int @default(0)
}

// Table de Référence des Compétences (L'arbre)
model RefSkill {
  id          Int     @id 
  name        String  @unique
   
  // Infos générales
  type        String? // "A", "E", "P", "C", "S"
  element     String? // "Feu", "Bois"...
  // 1 = Normal, 2 = Arbre 2 (Invoc/50+), 3 = Sphère
  skillNature Int     @default(1)
  description String?
  raceId      String? // Ex: "Wanwan", "Kabuki", ou null
  
  // Stats techniques
  energy      Int?    @default(0)
  probability Int?    @default(0)
  priority    Int?    @default(0)
 
  // Relations inverses vers les Dinozs
  dinozsLearned   Dinoz[] @relation("LearnedSkills")
  dinozsUnlocked  Dinoz[] @relation("UnlockedSkills")
 
  // --- RELATION PARENT/ENFANT (Arbre de compétences) ---
  // On supprime "parentSkillId" !
  // On met des crochets [] des deux côtés pour dire "Plusieurs parents possibles"
  parents      RefSkill[] @relation("SkillTree")
  children     RefSkill[] @relation("SkillTree")
}